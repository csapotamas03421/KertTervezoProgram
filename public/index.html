<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Kerttervez≈ë</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>

<div id="alap">

    <!-- ================= N√ñV√âNY HOZZ√ÅAD√ÅS ================= -->
    <div id="novenyHozzaadas">
        <h3>N√∂v√©ny hozz√°ad√°sa</h3>

        <form action="/add" method="POST">
            <input type="text" name="magyar" placeholder="Magyar n√©v" required><br><br>
            <input type="text" name="latin" placeholder="Latin n√©v" required><br><br>
            <input type="text" name="faj" placeholder="Faj" required><br><br>
            <input type="text" name="fajta" placeholder="Fajta" required><br><br>
            <input type="number" name="sortav" placeholder="Sort√°v (cm)" required><br><br>
            <input type="number" name="totav" placeholder="T≈ët√°v (cm)" required><br><br>
            <input type="text" name="szereti" placeholder="Szereti (n√∂v√©ny, ...)"><br><br>
            <input type="text" name="nem_szereti" placeholder="Nem szereti (n√∂v√©ny, ...)"><br><br>

            <button type="submit">Hozz√°ad√°s</button>
        </form>
    </div>

    <hr>

    <!-- ================= KERT M√âRETEZ√âS ================= -->
    <div id="kertmeretMegadasa">
        <h3>Kert m√©reteinek megad√°sa</h3>

        <!-- FONTOS: nem submitol -->
        <form onsubmit="return false;">
            <input type="number" name="kert_szelessege" placeholder="Kert sz√©less√©ge (m)"><br><br>
            <input type="number" name="kert_magassaga" placeholder="Kert magass√°ga (m)"><br><br>

            <button type="button" id="kertSzamitas">Kert ter√ºlet sz√°m√≠t√°sa</button>

            <br><br>

            <input type="number" name="agyasok_szelessege" placeholder="√Ågy√°sok sz√©less√©ge (m)"><br><br>
            <input type="number" name="agyasok_magassaga" placeholder="√Ågy√°sok magass√°ga (m)"><br><br>
            <input type="number" name="agyasok_darabszama" placeholder="√Ågy√°sok darabsz√°ma"><br><br>

            <button type="button" id="agyasSzamitas">√Ågy√°sok √∂sszter√ºlete</button>
            <button type="button" id="agyasReset">√Ågy√°sok t√∂rl√©se</button>

            <br>
            <button type="button" id="ellenorzes">Tervez√©s (elf√©r-e)</button>
            <br>

            <!-- ===== N√ñV√âNYEK LEGD√ñR√úL≈ê LISTA ===== -->
            <select id="novenyekLista">
                <option value="" disabled selected>V√°lassz n√∂v√©nyt</option>
            </select>
            <input type="number" name="noveny_darabszama" placeholder="N√∂v√©ny darabsz√°ma"><br><br>
            <button type="button" id="noveny_elhelyezes">N√∂v√©ny elhelyez√©se</button><br><br>

            <br><br>

            <button type="button" id="megjelenites">Megjelen√≠t√©s</button>
        </form>
    </div>

</div>

<script>
let jo_kert = false;

/* ===== KERT TER√úLET ===== */
document.getElementById("kertSzamitas").onclick = () => {
    const sz = Number(document.querySelector('[name="kert_szelessege"]').value);
    const m = Number(document.querySelector('[name="kert_magassaga"]').value);
    if (sz && m) {
        alert(`A kert ter√ºlete: ${sz * m} m¬≤`);
    }
};

/* ===== √ÅGY√ÅS TER√úLET ===== */
document.getElementById("agyasSzamitas").onclick = () => {
    const sz = Number(document.querySelector('[name="agyasok_szelessege"]').value);
    const m = Number(document.querySelector('[name="agyasok_magassaga"]').value);
    const db = Number(document.querySelector('[name="agyasok_darabszama"]').value);
    if (sz && m && db) {
        alert(`√Ågy√°sok √∂sszter√ºlete: ${sz * m * db} m¬≤`);
    }
};

/* ===== RESET ===== */
document.getElementById("agyasReset").onclick = () => {
    document.querySelector('[name="agyasok_szelessege"]').value = "";
    document.querySelector('[name="agyasok_magassaga"]').value = "";
    document.querySelector('[name="agyasok_darabszama"]').value = "";
};

/* ===== ELFER-E ===== */
document.getElementById("ellenorzes").onclick = () => {
    const kertT =
        Number(document.querySelector('[name="kert_szelessege"]').value) *
        Number(document.querySelector('[name="kert_magassaga"]').value);

    const agyasT =
        Number(document.querySelector('[name="agyasok_szelessege"]').value) *
        Number(document.querySelector('[name="agyasok_magassaga"]').value) *
        Number(document.querySelector('[name="agyasok_darabszama"]').value);

    jo_kert = agyasT <= kertT;
    alert(jo_kert ? "Az √°gy√°sok elf√©rnek." : "Az √°gy√°sok nem f√©rnek el.");
};

/* ===== KERT MENT√âS ===== */
document.getElementById("megjelenites").onclick = () => {
    if (!jo_kert) {
        alert("El≈ëbb ellen≈ërizd, hogy elf√©rnek-e!");
        return;
    }

    fetch("/saveGarden", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            kert_szelessege: document.querySelector('[name="kert_szelessege"]').value,
            kert_magassaga: document.querySelector('[name="kert_magassaga"]').value,
            agyasok_szelessege: document.querySelector('[name="agyasok_szelessege"]').value,
            agyasok_magassaga: document.querySelector('[name="agyasok_magassaga"]').value,
            agyasok_darabszama: document.querySelector('[name="agyasok_darabszama"]').value
        })
    }).then(() => {
        window.location.href = "kert_megjelenites.html";
    });
};

/* ===== üå± N√ñV√âNYEK BET√ñLT√âSE JSON-B≈êL ===== */
fetch('/data/novenyAdatok.json')
    .then(r => {
        if (!r.ok) throw new Error("JSON nem √©rhet≈ë el");
        return r.json();
    })
    .then(data => {
        const select = document.getElementById("novenyekLista");
        data.forEach(noveny => {
            const option = document.createElement("option");
            option.value = noveny.id;
            option.textContent = noveny.magyar;
            select.appendChild(option);
        });
    })
    .catch(err => console.error("Bet√∂lt√©si hiba:", err));

/* ===== üå± N√ñV√âNY ELHELYEZ√âS ===== */
document.getElementById("noveny_elhelyezes").onclick = () => {
    const select = document.getElementById("novenyekLista");
    const darab = Number(document.querySelector('[name="noveny_darabszama"]').value);

    if (!select.value) {
        alert("Nem v√°lasztott√°l n√∂v√©nyt!");
        return;
    }

    if (!darab || darab <= 0) {
        alert("Adj meg egy √©rv√©nyes darabsz√°mot!");
        return;
    }

    const novenyNev = select.options[select.selectedIndex].text;

    alert(`Elhelyezve: ${darab} db ${novenyNev}`);
};

</script>

</body>
</html>